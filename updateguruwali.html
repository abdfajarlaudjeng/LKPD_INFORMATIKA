<!doctype html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Evaluasi Guru Wali Canva</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.loading-spinner { border:3px solid #f3f4f6;border-top:3px solid #3b82f6;border-radius:50%;width:20px;height:20px;animation:spin 1s linear infinite; }
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 font-sans min-h-screen p-6">

<header class="bg-white p-6 rounded-lg shadow mb-6">
  <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ“˜ Sistem Evaluasi Guru Wali</h1>
  <p class="text-gray-600">Input Data Guru dan Evaluasi Siswa</p>
</header>

<!-- FORM GURU -->
<div class="bg-white rounded-lg shadow p-6 mb-6">
  <h2 class="text-xl font-semibold mb-4 text-gray-800">ğŸ§‘â€ğŸ« Input Data Guru</h2>
  <form id="guru-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <input type="text" id="nama-guru" placeholder="Nama Guru" required class="border p-2 rounded">
    <input type="text" id="kelas" placeholder="Kelas (misal: 7A)" required class="border p-2 rounded">
    <input type="text" id="mapel" placeholder="Mata Pelajaran" required class="border p-2 rounded">
    <input type="text" id="semester" placeholder="Semester (Ganjil/Genap)" required class="border p-2 rounded">
    <button type="submit" id="save-guru" class="md:col-span-2 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">Simpan Data Guru</button>
  </form>
</div>

<!-- FORM SISWA -->
<div class="bg-white rounded-lg shadow p-6 mb-6">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold text-gray-800">ğŸ‘©â€ğŸ“ Tambah Evaluasi Siswa</h2>
    <button id="toggle-form" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Tambah Siswa</button>
  </div>
  <form id="student-form" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
    <input type="text" id="student-name" placeholder="Nama Siswa" required class="border p-2 rounded">
    <input type="text" id="student-class" placeholder="Kelas (misal: 7A)" required class="border p-2 rounded">
    <input type="number" id="academic-score" placeholder="Nilai Akademik (0-100)" required class="border p-2 rounded">
    <input type="number" id="behavior-score" placeholder="Nilai Perilaku (0-100)" required class="border p-2 rounded">
    <input type="number" id="attendance" placeholder="Kehadiran (%)" required class="border p-2 rounded">
    <input type="text" id="student-semester" placeholder="Semester" required class="border p-2 rounded">
    <textarea id="notes" rows="3" placeholder="Catatan Evaluasi" class="border p-2 rounded md:col-span-2"></textarea>
    <button type="submit" id="submit-btn" class="md:col-span-2 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded flex items-center justify-center gap-2">
      <span>Simpan Evaluasi</span><div id="submit-loading" class="loading-spinner hidden"></div>
    </button>
  </form>
</div>

<!-- TABEL -->
<div class="bg-white rounded-lg shadow p-6">
  <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“„ Daftar Evaluasi Siswa</h2>
  <div class="overflow-x-auto">
    <table class="w-full text-sm text-left">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-2">Nama</th>
          <th class="px-4 py-2">Kelas</th>
          <th class="px-4 py-2">Akademik</th>
          <th class="px-4 py-2">Perilaku</th>
          <th class="px-4 py-2">Kehadiran</th>
          <th class="px-4 py-2">Semester</th>
          <th class="px-4 py-2">Catatan</th>
        </tr>
      </thead>
      <tbody id="students-table"></tbody>
    </table>
  </div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby-wZW3ZcM-pQKtOsGdno-AcXYOrax0LPifsJ9001o5T9UjoYZaRfUtahiGsV1vU7XM/exec"; // Ganti dengan URL Web App kamu
let students = [];

document.getElementById("guru-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const guruData = {
    type: "guru",
    nama_guru: document.getElementById("nama-guru").value.trim(),
    kelas: document.getElementById("kelas").value.trim(),
    mapel: document.getElementById("mapel").value.trim(),
    semester: document.getElementById("semester").value.trim()
  };
  await fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(guruData),
    headers: {"Content-Type": "application/json"}
  });
  alert("âœ… Data guru berhasil disimpan!");
});

document.getElementById("toggle-form").addEventListener("click", () => {
  document.getElementById("student-form").classList.toggle("hidden");
});

document.getElementById("student-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const data = {
    type: "siswa",
    student_id: "student_" + Date.now(),
    name: document.getElementById("student-name").value.trim(),
    class: document.getElementById("student-class").value.trim(),
    academic_score: parseInt(document.getElementById("academic-score").value),
    behavior_score: parseInt(document.getElementById("behavior-score").value),
    attendance_percentage: parseInt(document.getElementById("attendance").value),
    semester: document.getElementById("student-semester").value.trim(),
    notes: document.getElementById("notes").value.trim(),
    evaluation_date: new Date().toISOString()
  };
  document.getElementById("submit-loading").classList.remove("hidden");
  await fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(data),
    headers: {"Content-Type": "application/json"}
  });
  document.getElementById("submit-loading").classList.add("hidden");
  alert("âœ… Data siswa berhasil disimpan!");
  e.target.reset();
  fetchStudents(data.class);
});

async function fetchStudents(kelas) {
  const res = await fetch(WEB_APP_URL + "?kelas=" + encodeURIComponent(kelas));
  students = await res.json();
  renderStudents();
}

function renderStudents() {
  const tbody = document.getElementById("students-table");
  tbody.innerHTML = "";
  students.forEach(s => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="px-4 py-2">${s.name}</td>
      <td class="px-4 py-2">${s.class}</td>
      <td class="px-4 py-2">${s.academic_score}</td>
      <td class="px-4 py-2">${s.behavior_score}</td>
      <td class="px-4 py-2">${s.attendance_percentage}%</td>
      <td class="px-4 py-2">${s.semester}</td>
      <td class="px-4 py-2">${s.notes}</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
