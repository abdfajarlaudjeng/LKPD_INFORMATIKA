<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LKPD - Perangkat Keras TIK</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; background-color: #f4f4f4; margin: 0; padding: 0; }
        header { background-color: #00796b; color: #ffffff; padding: 1rem; text-align: center; }
        nav { background: #333; color: #fff; padding: 0.5rem; text-align: center; }
        nav a { color: #fff; padding: 0.5rem 1rem; text-decoration: none; }
        nav a:hover { background: #555; }
        nav a.active { background-color: #00796b; font-weight: bold; }
        main { max-width: 900px; margin: 1rem auto; padding: 1rem; }
        section { background: #fff; margin-bottom: 1rem; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { color: #00796b; border-bottom: 2px solid #f4f4f4; padding-bottom: 0.5rem; }
        h3 { color: #004d40; }
        
        /* Gaya Materi (Sama seperti sebelumnya) */
        .hardware-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
        .hardware-item { text-align: center; }
        .hardware-item img { width: 100px; height: 100px; object-fit: contain; border: 1px solid #ddd; border-radius: 4px; padding: 5px; }
        .rangkuman-list { list-style-type: 'âœ…'; padding-left: 20px; }
        
        /* Gaya LKPD Dinamis */
        #lkpd-form table { width: 100%; border-collapse: collapse; }
        #lkpd-form th, #lkpd-form td { padding: 10px; border: 1px solid #ddd; text-align: left; vertical-align: middle; }
        #lkpd-form th:first-child, #lkpd-form td:first-child { width: 150px; text-align: center; }
        #lkpd-form img { width: 120px; height: 120px; object-fit: contain; border-radius: 4px; }
        #lkpd-form select { width: 100%; padding: 8px; font-size: 1rem; border-radius: 4px; }
        #loading-lkpd { text-align: center; font-style: italic; color: #555; }
        
        .form-grup { margin-bottom: 1rem; }
        .form-grup label { display: block; margin-bottom: 0.3rem; font-weight: bold; }
        .form-grup input[type="text"] { width: 100%; padding: 0.5rem; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        
        button { background: #00796b; color: #fff; padding: 0.7rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; }
        button:hover { background: #004d40; }
        
        #form-message { margin-top: 15px; font-weight: bold; font-size: 1.2rem; text-align: center; }
        
        footer { text-align: center; padding: 1rem; background: #333; color: #fff; margin-top: 2rem; }
    </style>
</head>
<body>
    <header><h1>Modul Interaktif: Perangkat Keras Komputer</h1></header>
    <nav>
        <a href="index.html">Input Data</a>
        <a href="dashboard.html">Lihat Dashboard</a>
        <a href="submit-karya.html">Kumpulkan Karya</a>
        <a href="lkpd-hardware.html" class="active">LKPD Hardware</a>
    </nav>

    <main>
        
        <section id="materi">
            <h2>Materi: Mengenal Perangkat Keras (Hardware)</h2>
            <p><strong>Perangkat Keras (Hardware)</strong> adalah...</p>
        </section>

        <section id="rangkuman">
            <h2>Rangkuman Materi</h2>
            <ul class="rangkuman-list">
                <li><strong>Hardware</strong> adalah perangkat fisik...</li>
            </ul>
        section>

        <section id="lkpd-section">
            <h2>LKPD: Jodohkan Gambar!</h2>
            <p>Setelah membaca materi, ayo uji pemahamanmu! Jodohkan gambar di sebelah kiri dengan nama perangkat yang tepat di sebelah kanan.</p>
            
            <form id="lkpd-form">
                <input type="hidden" name="formType" value="lkpdMatch">

                <div class="form-grup">
                    <label for="nama_siswa">Nama Lengkap Siswa:</label>
                    <input type="text" id="nama_siswa" name="nama_siswa" required>
                </div>
                <div class="form-grup">
                    <label for="kelas">Kelas:</label>
                    <input type="text" id="kelas" name="kelas" placeholder="Contoh: 7A" required>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Gambar</th>
                            <th>Nama Perangkat</th>
                        </tr>
                    </thead>
                    <tbody id="lkpd-tbody">
                        </tbody>
                </table>
                <p id="loading-lkpd">Memuat soal dari database...</p>
                <br>
                <button type="submit" id="submit-button" style="display:none;">Kumpulkan Jawaban</button>
            </form>
            <div id="form-message"></div>
        </section>
        
    </main>
    <footer><p>&copy; 2025 - Proyek Fase D</p></footer>

    <script>
        // GANTI DENGAN URL SCRIPT ANDA YANG BARU (WAJIB!)
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwzly9QhxKtk2KbTE0wJ2tbbzIouNo6HbBEiLr2AxeqL6vq1JzHJmdrqjgAqIQyU85zFw/exec';
        
        const form = document.getElementById('lkpd-form');
        const lkpdTbody = document.getElementById('lkpd-tbody');
        const loadingMsg = document.getElementById('loading-lkpd');
        const messageDiv = document.getElementById('form-message');
        const submitButton = document.getElementById('submit-button');

        let globalSoalData = []; // Untuk menyimpan data soal (kunci jawaban)

        // 1. Ambil Soal saat halaman dimuat
        window.addEventListener('DOMContentLoaded', () => {
            fetch(scriptURL + "?action=getSoalLKPD")
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success' && data.data.length > 0) {
                        globalSoalData = data.data; // Simpan data soal
                        buildLKPDForm(globalSoalData);
                        loadingMsg.style.display = 'none';
                        submitButton.style.display = 'block'; // Tampilkan tombol submit
                    } else {
                        throw new Error(data.message || 'Tidak ada soal ditemukan di database.');
                    }
                })
                .catch(error => {
                    loadingMsg.textContent = 'Gagal memuat soal: ' + error.message;
                    loadingMsg.style.color = 'red';
                });
        });

        // 2. Fungsi untuk membangun tabel soal dari data JSON
        function buildLKPDForm(soalArray) {
            lkpdTbody.innerHTML = ''; // Kosongkan tabel
            
            soalArray.forEach(soal => {
                const tr = document.createElement('tr');
                
                // Kolom Gambar
                const tdGambar = document.createElement('td');
                const img = document.createElement('img');
                img.src = soal.gambar_url;
                img.alt = "Soal Gambar";
                tdGambar.appendChild(img);
                
                // Kolom Pilihan
                const tdPilihan = document.createElement('td');
                const select = document.createElement('select');
                select.name = `jawaban_${soal.id}`; // name dinamis, cth: jawaban_q1
                select.required = true;
                
                // Opsi default
                const optDefault = document.createElement('option');
                optDefault.value = "";
                optDefault.textContent = "-- Pilih Jawaban --";
                select.appendChild(optDefault);
                
                // Buat opsi dari string 'opsi_pilihan'
                const opsiArray = soal.opsi_pilihan.split(',');
                opsiArray.forEach(opsi => {
                    const opt = document.createElement('option');
                    opt.value = opsi;
                    opt.textContent = opsi;
                    select.appendChild(opt);
                });
                
                tdPilihan.appendChild(select);
                
                tr.appendChild(tdGambar);
                tr.appendChild(tdPilihan);
                lkpdTbody.appendChild(tr);
            });
        }

        // 3. Kirim Jawaban (Form Submit)
        form.addEventListener('submit', e => {
            e.preventDefault();
            submitButton.disabled = true;
            messageDiv.textContent = 'Memeriksa dan mengirim jawaban...';
            
            let skor = 0;
            const totalSoal = globalSoalData.length;
            const formData = new FormData(); // Data untuk dikirim ke Google Sheet
            
            // Tambahkan data siswa dan formType
            formData.append('formType', 'lkpdMatch'); // Penting!
            formData.append('nama_siswa', form.nama_siswa.value);
            formData.append('kelas', form.kelas.value);

            // Periksa jawaban secara dinamis
            globalSoalData.forEach(soal => {
                const soalId = soal.id; // cth: "q1"
                const jawabanBenar = soal.jawaban_benar;
                
                // Temukan <select> di dalam form
                const selectElement = form.querySelector(`select[name="jawaban_${soalId}"]`);
                const jawabanSiswa = selectElement.value;
                
                // Hitung skor
                if (jawabanSiswa === jawabanBenar) {
                    skor++;
                }
                
                // Tambahkan jawaban siswa ke formData untuk dikirim ke Sheet
                formData.append(`jawaban_${soalId}`, jawabanSiswa);
            });

            // Konversi skor ke 0-100
            const skorPersen = Math.round((skor / totalSoal) * 100);
            formData.append('skor', skorPersen); // Tambahkan skor ke formData

            // Mengirim data
            fetch(scriptURL, { method: 'POST', body: formData})
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        messageDiv.textContent = `LKPD berhasil dikirim! Skor Anda: ${skorPersen} (Benar ${skor} dari ${totalSoal} soal).`;
                        messageDiv.style.color = 'green';
                        form.reset();
                    } else { throw new Error(data.message || 'Terjadi kesalahan'); }
                })
                .catch(error => {
                    messageDiv.textContent = 'Oops! Gagal mengirim. ' + error.message;
                    messageDiv.style.color = 'red';
                    submitButton.disabled = false;
                });
        });
    </script>
</body>
</html>
